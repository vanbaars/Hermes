-- Haal de realisatie op van de verplichtingen
--select distinct glb.ledger_id from EBS_GL_INSTR_BALANCES_V glb
select * from EBS_GL_INSTR_BALANCES_V glb
where 4=4
and glb.actual_flag = 'E'                   -- Encumbrance = verplichting boekingen     
and (glb.encumbrance_type_id = 1000         -- 1000 = zachte verplichting 
     or glb.encumbrance_type_id = 1001      -- 1001 = harde verplichting 
     or glb.encumbrance_type_id = 1081)     -- 1081 = middelen blokkering 
and glb.instrumentnummer = '040000'
--and glb.ledger_id = 2228 -- kas
and glb.ledger_id = 2267                    -- vpl grootboek
and glb.period_year = 2019                  -- boekjaar EBS
and glb.period_num = 12                     -- periode nummer 12 = december
;

-- Haal de realisatie op van de verplichtingen direct uit EBS tabellen
select  gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7||'.'||gcc.segment8 gb_rek
,       glb.ledger_id
,       glb.period_name
,       glb.actual_flag
,       glb.encumbrance_type_id
,       glb.period_year
,       glb.period_num
,       (glb.begin_balance_dr - glb.begin_balance_cr) + (glb.period_net_dr - glb.period_net_cr) saldo_ytd
,       round(((glb.begin_balance_dr - glb.begin_balance_cr) + (glb.period_net_dr - glb.period_net_cr))/1000,0) saldo_ytd_1000
,       glb.begin_balance_dr
,       glb.begin_balance_cr
,       glb.period_net_dr
,       glb.period_net_cr
from gl_balances glb
,    gl_code_combinations gcc
,    gl_summary_templates gst
where 4=4
and glb.code_combination_id = gcc.code_combination_id 
and gcc.template_id         = gst.template_id
and upper(gst.concatenated_description) = 'D.T.D.D.T.T.T.T'    -- totaal per bedrijf, instrument en kostensoort
--and upper(gst.concatenated_description) = 'D.T.D.T.T.T.T.T'     --totaal per bedrijf en instrument
and glb.actual_flag = 'E'                                       -- Encumbrance = verplichting boekingen     
and (glb.encumbrance_type_id = 1000                             -- 1000 = zachte verplichting 
     or glb.encumbrance_type_id = 1001                          -- 1001 = harde verplichting 
     or glb.encumbrance_type_id = 1081                          -- 1081 = middelen blokkering 
     or glb.encumbrance_type_id = 1060)
and gcc.segment3 = '040000'
and glb.ledger_id = 2228                                        -- kas grootboek
--and glb.ledger_id = 2267                                        -- vpl grootboek
and glb.period_year = 2019                                      -- boekjaar EBS
and glb.period_num = 12                                         -- periode nummer 12 = december
order by glb.ledger_id, gb_rek, glb.encumbrance_type_id
;


-- Haal de realisatie op van de verplichtingen direct uit EBS tabellen
select  gcc.segment1||'.'||gcc.segment2||'.'||gcc.segment3||'.'||gcc.segment4||'.'||gcc.segment5||'.'||gcc.segment6||'.'||gcc.segment7||'.'||gcc.segment8 gb_rek
,       glb.ledger_id
,       glb.period_name
,       glb.actual_flag
,       glb.encumbrance_type_id
,       glb.period_year
,       glb.period_num
,       (glb.begin_balance_dr - glb.begin_balance_cr) + (glb.period_net_dr - glb.period_net_cr) saldo_ytd
,       round(((glb.begin_balance_dr - glb.begin_balance_cr) + (glb.period_net_dr - glb.period_net_cr))/1000,0) saldo_ytd_1000
,       glb.begin_balance_dr
,       glb.begin_balance_cr
,       glb.period_net_dr
,       glb.period_net_cr
from gl_balances glb
,    gl_code_combinations gcc
,    gl_summary_templates gst
where 4=4
and glb.code_combination_id = gcc.code_combination_id 
and gcc.template_id         = gst.template_id
and upper(gst.concatenated_description) = 'D.T.D.D.T.T.T.T'    -- totaal per bedrijf, instrument en kostensoort
--and upper(gst.concatenated_description) = 'D.T.D.T.T.T.T.T'     --totaal per bedrijf en instrument
/*and ((glb.actual_flag = 'E'                                       -- Encumbrance = verplichting boekingen     
        and (glb.encumbrance_type_id = 1000                             -- 1000 = zachte verplichting 
             or glb.encumbrance_type_id = 1001                          -- 1001 = harde verplichting 
             or glb.encumbrance_type_id = 1081                        -- 1081 = middelen blokkering 
             or glb.encumbrance_type_id = 1060)
     ) or
     glb.actual_flag = 'A') */
and glb.actual_flag = 'A'
and gcc.segment3 = '010300'
and glb.ledger_id = 2228                                        -- kas grootboek
--and glb.ledger_id = 2267                                        -- vpl grootboek
and glb.period_year = 2019                                      -- boekjaar EBS
and glb.period_num = 12                                         -- periode nummer 12 = december
order by glb.ledger_id, glb.actual_flag desc, gb_rek, glb.encumbrance_type_id
;


select distinct glb.encumbrance_type_id from EBS_GL_INSTR_BALANCES_V glb
;

--Budget Uitgaven Verplichtingen 
select gcc.segment3
,      hpr.jaar
,      sum (hpr.bedrag) budget
,      hpr.ministerie
/*      hbm.nummer
,      hbm.jaar
,      gcc.segment3 instrument
,      hmp.type parent
,      hmp.soort vplkas
,      hpr.jaar
,      hpr.bedrag
,      hpr.ministerie  --*/
from hms_budget_mutaties     hbm
,    hms_mutatie_posten      hmp
,    hms_post_regels         hpr
,    gl_code_combinations    gcc
,    hms_mutatie_voortgang   hmv
,    hms_mutatie_soorten     hms
where hbm.id = hmp.bme_id
and   hmp.id = hpr.mpt_id
and   hmp.code_combination_id = gcc.code_combination_id
and   hbm.mgg_id = hmv.id
and   hbm.mst_id = hms.id
and   hmv.id = 6 --Goedgekeurd
and   hms.id <> 62  --Jaarwissel
and   hmp.type = 'P'
and   hmp.soort = 'V'
and   hbm.ministerie = 1
and   gcc.segment3 = '451000'
--and   hbm.jaar = '2018'
and   hpr.jaar = '2019'
group by  gcc.segment3 , hmp.type , hmp.soort , hpr.jaar ,   hpr.ministerie
;

--Budget Uitgaven Kas 
select gcc.segment3
,      hpr.jaar
,      sum (hpr.bedrag) budget
,      hpr.ministerie --*/
       /*hbm.nummer
,      hbm.jaar
,      gcc.segment3 instrument
,      gcc.segment4 kostensoort
,      hmpc.type parent
,      hmpc.soort vplkas
,      hpr.jaar
,      hpr.bedrag
,      hpr.ministerie  --*/
from hms_budget_mutaties     hbm
,    hms_mutatie_posten      hmpp
,    hms_mutatie_posten      hmpc
,    hms_post_regels         hpr
,    gl_code_combinations    gcc
,    hms_mutatie_voortgang   hmv
,    hms_mutatie_soorten     hms
where hbm.id = hmpp.bme_id
--and   hbm.id = hmpc.bme_id
and   hmpp.id = hmpc.mpt_id
and   hmpc.id = hpr.mpt_id
and   hmpp.code_combination_id = gcc.code_combination_id
and   hbm.mgg_id = hmv.id
and   hbm.mst_id = hms.id
and   hmv.id = 6 --Goedgekeurd
and   hms.id <> 62  --Jaarwissel
and   hmpp.type = 'P'
and   hmpp.soort = 'V'
and   hmpc.type = 'C'
and   hmpc.soort = 'K'
and   hpr.ministerie = 1
and   gcc.segment3 = '010300'
--and   hbm.jaar = '2018'
and   hpr.jaar = '2019'
group by  gcc.segment3 , hmpc.type , hmpc.soort , hpr.jaar ,   hpr.ministerie
;


--Budget Ontvangsten Kas
select gcc.segment3
,      sum (hpr.bedrag) budget    
/*      hbm.nummer
,      hbm.jaar
,      gcc.segment3 instrument
,      hmp.type parent
,      hmp.soort vplkas
,      hpr.jaar
,      hpr.bedrag
,      hpr.ministerie  --*/
from hms_budget_mutaties     hbm
,    hms_mutatie_posten      hmp
,    hms_post_regels         hpr
,    gl_code_combinations    gcc
,    hms_mutatie_voortgang   hmv
,    hms_mutatie_soorten     hms
where hbm.id = hmp.bme_id
and   hmp.id = hpr.mpt_id
and   hmp.code_combination_id = gcc.code_combination_id
and   hbm.mgg_id = hmv.id
and   hbm.mst_id = hms.id
and   hmv.id = 6 --Goedgekeurd
and   hms.id <> 62  --Jaarwissel
and   hmp.type = 'P'
and   hmp.soort = 'K'
and   hpr.ministerie = 1
and   gcc.segment3 = '040000'
--and   hbm.jaar = '2018'
and   hpr.jaar = '2019'
group by  gcc.segment3 , hmp.type , hmp.soort , hpr.jaar ,   hpr.ministerie
;

select * from hms_mutatie_soorten hms;

select * from hms_mutatie_voortgang hmv;

select * from GL_CODE_COMBINATIONS--;
where code_combination_id = 2843401 --02843138
;

select * from gl_balances;


select * from hms_budget_mutaties;

select * from hms_mutatie_posten
where type = 'C' and soort = 'K'
;

select * from hms_mutatie_posten
where type = 'P' and soort = 'V'
;

select * from hms_post_regels;




select hbm.nummer
,      hbm.jaar
,      gcc.segment3 instrument
,      hmp.type parent
,      hmp.soort vplkas
,      hpr.jaar
,      hpr.bedrag
,      hpr.ministerie  --*/
from hms_budget_mutaties     hbm
,    hms_mutatie_posten      hmp
,    hms_post_regels         hpr
,    gl_code_combinations    gcc
,    hms_mutatie_voortgang   hmv
,    hms_mutatie_soorten     hms
where hbm.id = hmp.bme_id
and   hmp.id = hpr.mpt_id
and   hmp.code_combination_id = gcc.code_combination_id
and   hbm.mgg_id = hmv.id
and   hbm.mst_id = hms.id
and   hmv.id = 6 --Goedgekeurd
and   hms.id <> 62  --Jaarwissel
and   hmp.type = 'P'
and   hmp.soort = 'V'
and   hpr.ministerie = 1
and   gcc.segment3 = '030050'
--and   hbm.jaar = '2018'
and   hpr.jaar = '2019'
;

--Budget Uitgaven Kas 
select /*gcc.segment3
,      hpr.jaar
,      sum (hpr.bedrag) budget
,      hpr.ministerie --*/
       hbm.nummer
,      hbm.jaar
,      gcc.segment3 instrument
,      gcc.segment4 kostensoort
,      hmpc.type parent
,      hmpc.soort vplkas
,      hpr.jaar
,      hpr.bedrag
,      hpr.ministerie  --*/
,      hbm.id bme_id
,      hmpp.id id_p
,      hmpp.bme_id bme_id_p
,      hmpp.mpt_id mpt_id_p
,      hmpp.prl_id prl_id_p
,      hmpc.id id_c
,      hmpc.bme_id bme_id_c
,      hmpc.mpt_id mpt_id_c
,      hmpc.prl_id prl_id_c
from hms_budget_mutaties     hbm
,    hms_mutatie_posten      hmpp
,    hms_mutatie_posten      hmpc
,    hms_post_regels         hpr
,    gl_code_combinations    gcc
,    hms_mutatie_voortgang   hmv
,    hms_mutatie_soorten     hms
where hbm.id = hmpp.bme_id
--and   hbm.id = hmpc.bme_id
and   hmpp.id = hmpc.mpt_id
and   hmpc.id = hpr.mpt_id
and   hmpp.code_combination_id = gcc.code_combination_id
and   hbm.mgg_id = hmv.id
and   hbm.mst_id = hms.id
--and   hmv.id = 6 --Goedgekeurd
and   hms.id <> 62  --Jaarwissel
--and   hmpp.type = 'P'
--and   hmpp.soort = 'V'
--and   hmpc.type = 'C'
--and   hmpc.soort = 'K'
and   hpr.ministerie = 1
and   gcc.segment3 = '010300'
--and   hbm.jaar = '2018'
and   hpr.jaar = '2019'
--group by  gcc.segment3 , hmpc.type , hmpc.soort , hpr.jaar ,   hpr.ministerie
;
